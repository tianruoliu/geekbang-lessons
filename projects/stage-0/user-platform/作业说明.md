# 一致性hash算法

## 作业代码

1. 不带虚拟节点的一致性hash算法实现：user-web子模块下的`org.geektimes.projects.user.arithmetic.SimpleConsistentHashArithmetic`

2. 加入虚拟节点的一致性hash：user-web子模块下的org.geektimes.projects.user.arithmetic.StandardConsistentHashArithmetic

## 学习笔记

**先构造一个长度为2^32的整数环（这个环被称为一致性Hash环），根据节点名称的Hash值（其分布为[0, 232-1]）将服务器节点放置在这个Hash环上，然后根据数据的Key值计算得到其Hash值（其分布也为[0, 232-1]），接着在Hash环上顺时针查找距离这个Key值的Hash值最近的服务器节点，完成Key到服务器的映射查找。**

+ 虚拟节点（实现更均衡的负载均衡）

  比如说有Hash环上有A、B、C三个服务器节点，分别有100个请求会被路由到相应服务器上。现在在A与B之间增加了一个节点D，这导致了原来会路由到B上的部分节点被路由到了D上，这样A、C上被路由到的请求明显多于B、D上的，原来三个服务器节点上均衡的负载被打破了。**某种程度上来说，这失去了负载均衡的意义，因为负载均衡的目的本身就是为了使得目标服务器均分所有的请求**。

  解决这个问题的办法是引入虚拟节点，其工作原理是：**将一个物理节点拆分为多个虚拟节点，并且同一个物理节点的虚拟节点尽量均匀分布在Hash环上**。采取这样的方式，就可以有效地解决增加或减少节点时候的负载不均衡的问题。

## 巨人的肩膀

1. https://www.cnblogs.com/xrq730/p/5186728.html

   > 五月的仓颉，阿里大佬

2. https://blog.csdn.net/suifeng629/article/details/81567777

   > 图解，通俗易懂